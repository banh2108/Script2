-- üìå Script 2: Ch·ªù base m·ªü v√† TP t·ªõi NPC ƒë√£ ch·ªçn

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Map = Workspace:WaitForChild("Map")
local TycoonsFolder = Map:WaitForChild("Tycoons")

-- T√¨m model hi·ªán t·∫°i t·ª´ t√™n (v√¨ model c≈© c√≥ th·ªÉ b·ªã respawn)
local function findModelByName(displayName)
	for i = 1, 8 do
		local tycoon = TycoonsFolder:FindFirstChild("Tycoon" .. i)
		if tycoon and tycoon:FindFirstChild("Temporary") then
			for _, model in ipairs(tycoon.Temporary:GetChildren()) do
				if model:IsA("Model") then
					local owner = tycoon:FindFirstChild("Tycoon") and tycoon.Tycoon:FindFirstChild("Board")
					local usernameLabel = owner and owner.Board and owner.Board:FindFirstChild("SurfaceGui") and owner.Board.SurfaceGui:FindFirstChild("Username")
					local ownerName = usernameLabel and usernameLabel:IsA("TextLabel") and usernameLabel.Text
					local composed = ownerName and (ownerName .. " - " .. model.Name)
					if composed == displayName then
						return model, tycoon
					end
				end
			end
		end
	end
	return nil, nil
end

-- T√¨m TextLabel Time
local function getTimeLabel(tycoon)
	local folder = tycoon.Tycoon:FindFirstChild("ForcefieldFolder")
	if folder then
		for _, part in ipairs(folder:GetChildren()) do
			local gui = part:FindFirstChild("Screen") and part.Screen:FindFirstChild("SurfaceGui")
			if gui and gui:FindFirstChild("Time") and gui.Time:IsA("TextLabel") then
				return gui.Time
			end
		end
	end
	return nil
end

local displayName = getgenv()._selectedModelName
if not displayName then
	warn("‚ö†Ô∏è Kh√¥ng c√≥ NPC n√†o ƒëang ƒë∆∞·ª£c theo d√µi.")
	return
end

-- T√¨m model v√† tycoon ch·ª©a model
local model, tycoon = findModelByName(displayName)
if not model or not tycoon then
	warn("‚ùå Kh√¥ng t√¨m th·∫•y NPC ho·∫∑c base ch·ª©a NPC:", displayName)
	return
end

local timeLabel = getTimeLabel(tycoon)
if not timeLabel then
	warn("‚ùå Kh√¥ng t√¨m th·∫•y ƒë·ªìng h·ªì Forcefield.")
	return
end

-- Theo d√µi th·ªùi gian
task.spawn(function()
	while true do
		task.wait(1)

		-- M·ªói l·∫ßn ki·ªÉm tra l·∫°i model (ph√≤ng tr∆∞·ªùng h·ª£p b·ªã respawn)
		model, tycoon = findModelByName(displayName)
		if not model then
			warn("‚ùå Model ƒë√£ b·ªã xo√° ho·∫∑c kh√¥ng t·ªìn t·∫°i.")
			break
		end

		local raw = tostring(timeLabel.Text):match("%d+") or "999"
		local number = tonumber(raw)

		if number and number <= 0 then
			local part = model.PrimaryPart or model:FindFirstChildWhichIsA("BasePart", true)
			if not part then
				-- N·∫øu model kh√¥ng c√≥ PrimaryPart, g√°n th·ªß c√¥ng
				for _, obj in ipairs(model:GetDescendants()) do
					if obj:IsA("BasePart") then
						part = obj
						break
					end
				end
			end

			if part then
				HumanoidRootPart.CFrame = part.CFrame + Vector3.new(0, 5, 0)
				warn("üí• Base m·ªü! ƒê√£ TP t·ªõi NPC:", displayName)
			else
				warn("‚ùå Kh√¥ng t√¨m th·∫•y v·ªã tr√≠ trong NPC ƒë·ªÉ TP.")
			end
			break
		end
	end
end)
