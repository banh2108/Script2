local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Map = Workspace:WaitForChild("Map")
local TycoonsFolder = Map:WaitForChild("Tycoons")

local function findModelByName(displayName)
	for i = 1, 8 do
		local tycoon = TycoonsFolder:FindFirstChild("Tycoon" .. i)
		if tycoon and tycoon:FindFirstChild("Temporary") then
			for _, model in ipairs(tycoon.Temporary:GetChildren()) do
				if model:IsA("Model") then
					local board = tycoon:FindFirstChild("Tycoon") and tycoon.Tycoon:FindFirstChild("Board")
					local label = board and board.Board and board.Board:FindFirstChild("SurfaceGui") and board.Board.SurfaceGui:FindFirstChild("Username")
					local ownerName = label and label:IsA("TextLabel") and label.Text
					if ownerName and (ownerName .. " - " .. model.Name) == displayName then
						return model, tycoon
					end
				end
			end
		end
	end
	return nil, nil
end

local function getTimeLabel(tycoon)
	local folder = tycoon.Tycoon:FindFirstChild("ForcefieldFolder")
	if folder then
		for _, part in ipairs(folder:GetChildren()) do
			local gui = part:FindFirstChild("Screen") and part.Screen:FindFirstChild("SurfaceGui")
			if gui and gui:FindFirstChild("Time") and gui.Time:IsA("TextLabel") then
				return gui.Time
			end
		end
	end
	return nil
end

local function getTeleportPart(model)
	if model.PrimaryPart then return model.PrimaryPart end
	for _, obj in ipairs(model:GetDescendants()) do
		if obj:IsA("BasePart") then
			return obj
		end
	end
	return nil
end

-- üöÄ Start process
local displayName = getgenv()._selectedModelName
if not displayName then
	warn("‚ö†Ô∏è Kh√¥ng c√≥ NPC n√†o ƒë∆∞·ª£c ch·ªçn.")
	return
end

print("‚ñ∂Ô∏è ƒêang theo d√µi NPC:", displayName)

local model, tycoon = findModelByName(displayName)
if not model or not tycoon then
	warn("‚ùå Kh√¥ng t√¨m th·∫•y NPC ho·∫∑c base.")
	return
end

local timeLabel = getTimeLabel(tycoon)
if not timeLabel then
	warn("‚ùå Kh√¥ng t√¨m th·∫•y ƒë·ªìng h·ªì base.")
	return
end

task.spawn(function()
	while true do
		task.wait(1)
		model, tycoon = findModelByName(displayName)
		timeLabel = getTimeLabel(tycoon)

		local timeText = timeLabel and timeLabel.Text
		local num = tonumber(timeText and timeText:match("%d+")) or 999

		if num <= 0 then
			local tpPart = getTeleportPart(model)
			if tpPart then
				HumanoidRootPart.CFrame = tpPart.CFrame + Vector3.new(0, 5, 0)
				print("‚úÖ TP t·ªõi NPC:", displayName)
			else
				warn("‚ùå Kh√¥ng t√¨m th·∫•y v·ªã tr√≠ TP.")
			end
			break
		end
	end
end)
