-- üìå Script 2: Theo d√µi base ƒë√£ ch·ªçn, TP khi time v·ªÅ 0
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Map = Workspace:WaitForChild("Map")
local TycoonsFolder = Map:WaitForChild("Tycoons")

-- üîç T√¨m model ƒëang ch·ªçn
local function findModelByName(displayName)
	for i = 1, 8 do
		local tycoon = TycoonsFolder:FindFirstChild("Tycoon" .. i)
		if tycoon and tycoon:FindFirstChild("Temporary") then
			for _, model in ipairs(tycoon.Temporary:GetChildren()) do
				if model:IsA("Model") then
					local board = tycoon:FindFirstChild("Tycoon") and tycoon.Tycoon:FindFirstChild("Board")
					local label = board and board.Board and board.Board:FindFirstChild("SurfaceGui") and board.Board.SurfaceGui:FindFirstChild("Username")
					local ownerName = label and label:IsA("TextLabel") and label.Text
					if ownerName and (ownerName .. " - " .. model.Name) == displayName then
						return model, tycoon
					end
				end
			end
		end
	end
	return nil, nil
end

-- üîç T√¨m time label ƒë√∫ng path m·ªõi
local function getTimeLabel(tycoon)
	local screen1 = tycoon:FindFirstChild("Tycoon"):FindFirstChild("ForcefieldFolder"):FindFirstChild("Screen")
	if not screen1 then return nil end

	local screen2 = screen1:FindFirstChild("Screen")
	local gui = screen2 and screen2:FindFirstChild("SurfaceGui")
	local timeLabel = gui and gui:FindFirstChild("Time")
	if timeLabel and timeLabel:IsA("TextLabel") then
		return timeLabel
	end
	return nil
end

-- üîç T√¨m part trong model ƒë·ªÉ TP
local function getTeleportPart(model)
	if model.PrimaryPart then return model.PrimaryPart end
	for _, obj in ipairs(model:GetDescendants()) do
		if obj:IsA("BasePart") then
			return obj
		end
	end
	return nil
end

-- ‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu theo d√µi
local displayName = getgenv()._selectedModelName
if not displayName then
	warn("‚ö†Ô∏è Kh√¥ng c√≥ NPC n√†o ƒë∆∞·ª£c ch·ªçn.")
	return
end

print("‚ñ∂Ô∏è ƒêang theo d√µi NPC:", displayName)

local model, tycoon = findModelByName(displayName)
if not model or not tycoon then
	warn("‚ùå Kh√¥ng t√¨m th·∫•y NPC ho·∫∑c base.")
	return
end

local timeLabel = getTimeLabel(tycoon)
if not timeLabel then
	warn("‚ùå Kh√¥ng t√¨m th·∫•y ƒë·ªìng h·ªì base.")
	return
end

-- üïí ƒê·ª£i base m·ªü
task.spawn(function()
	while true do
		task.wait(1)

		model, tycoon = findModelByName(displayName)
		timeLabel = getTimeLabel(tycoon)

		local text = timeLabel and timeLabel.Text or ""
		local number = tonumber(text:gsub("%D", "")) or 999

		print("[‚è≥] Time hi·ªán t·∫°i:", text, "‚Üí", number)

		if number == 0 then
			local tpPart = getTeleportPart(model)
			if tpPart then
				HumanoidRootPart.CFrame = tpPart.CFrame + Vector3.new(0, 5, 0)
				print("‚úÖ Base m·ªü! ƒê√£ TP t·ªõi:", displayName)
			else
				warn("‚ùå Kh√¥ng t√¨m th·∫•y v·ªã tr√≠ TP.")
			end
			break
		end
	end
end)
